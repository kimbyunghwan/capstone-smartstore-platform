<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìŠ¤ë§ˆíŠ¸ìŠ¤í† ì–´ - ìƒí’ˆ ìˆ˜ì •</title>
    <link th:href="@{/css/store.css}" rel="stylesheet" />
</head>
<body>
<!-- í—¤ë” ì‚½ì… -->
<div th:replace="~{fragments/header :: header}"></div>

<!-- ìƒí’ˆ ìˆ˜ì • -->
<section class="seller-product-section">
    <div class="container">
        <!-- í˜ì´ì§€ íƒ€ì´í‹€ -->
        <div class="page-header">
            <h2 class="page-title">ìƒí’ˆ ìˆ˜ì •</h2>
            <p class="page-description">ìƒí’ˆ ì •ë³´ë¥¼ ìˆ˜ì •í•˜ì„¸ìš”</p>
        </div>

        <!-- ìƒí’ˆ ìˆ˜ì • í¼ -->
        <form id="product-form" method="post" th:action="@{/seller/products/{id}/update(id=${product?.id})}" enctype="multipart/form-data">

            <input type="hidden" name="productId" th:value="${product?.id}" />

            <!-- ê¸°ë³¸ ì •ë³´ ì„¹ì…˜ -->
            <div class="form-section-box">
                <h3 class="section-title">ê¸°ë³¸ ì •ë³´</h3>

                <div class="form-group">
                    <label>ìƒí’ˆëª… <span class="required">*</span></label>
                    <input type="text" name="productName" th:value="${product?.name}" placeholder="ìƒí’ˆëª…ì„ ì…ë ¥í•˜ì„¸ìš”" maxlength="100" required />
                    <span class="char-count"><span id="name-count" th:text="${product?.name?.length() ?: 0}">0</span>/100</span>
                </div>

                <div class="form-group">
                    <label>ì¹´í…Œê³ ë¦¬ <span class="required">*</span></label>
                    <select name="categoryId" required>
                        <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                        <option
                                th:each="c : ${categories}"
                                th:value="${c.id}"
                                th:text="${c.name}"
                                th:selected="${selectedCategoryId != null and selectedCategoryId == c.id}">
                        </option>
                    </select>
                </div>

                <div class="form-row">
                    <!-- ê¸°ì¡´: th:value="${product?.originalPrice}" (ì—”í‹°í‹°ì— ì—†ìŒ) -->
                    <div class="form-row">
<!--                        <div class="form-group">-->
<!--                            <label>ì •ê°€ <span class="required">*</span></label>-->
<!--                            <input type="number" name="originalPrice"-->
<!--                                   th:value="${product != null and product.options != null and !product.options.isEmpty()-->
<!--                      ? product.options.get(0).price.amount-->
<!--                      : ''}"-->
<!--                                   placeholder="0" min="0" required />-->
<!--                            <span class="unit">ì›</span>-->
<!--                        </div>-->

                        <div class="form-group">
                            <label>íŒë§¤ê°€ <span class="required">*</span></label>
                            <input type="number" name="salePrice" step = 1
                                   th:value="${product != null and product.options != null and !product.options.isEmpty()
                      ? product.options.get(0).price.amount
                      : ''}"
                                   placeholder="0" min="0" required />
                            <span class="unit">ì›</span>
                        </div>
                    </div>
                </div>

<!--                    <div class="form-group">-->
<!--                        <label>í• ì¸ìœ¨</label>-->
<!--                        &lt;!&ndash; ì—”í‹°í‹°ì— í•„ë“œê°€ ì—†ìœ¼ë¯€ë¡œ ì¼ë‹¨ ë¹ˆ ê°’(ë˜ëŠ” 0) &ndash;&gt;-->
<!--                        <input type="number" name="discountRate" th:value="${null}" placeholder="0" min="0" max="100" />-->
<!--                        <span class="unit">%</span>-->
<!--                    </div>-->
            </div>

            <!-- ìƒí’ˆ ì„¤ëª… ì„¹ì…˜ -->
            <div class="form-section-box">
                <h3 class="section-title">ìƒí’ˆ ì„¤ëª…</h3>

                <div class="form-group">
                    <label>ì§§ì€ ì„¤ëª…</label>
                    <input type="text" name="shortDescription" th:value="${product?.shortDescription}" placeholder="ìƒí’ˆì„ í•œ ì¤„ë¡œ ì„¤ëª…í•´ì£¼ì„¸ìš”" maxlength="200" />
                    <span class="char-count"><span id="short-count" th:text="${product?.shortDescription?.length() ?: 0}">0</span>/200</span>
                </div>

                <div class="form-group">
                    <label>ìƒì„¸ ì„¤ëª… <span class="required">*</span></label>
                    <textarea name="description" rows="12" required th:text="${product?.description}"></textarea>
                </div>
            </div>

            <!-- ì´ë¯¸ì§€ ì„¹ì…˜ -->
            <div class="form-section-box">
                <h3 class="section-title">ìƒí’ˆ ì´ë¯¸ì§€</h3>

                <div class="form-group">
                    <label>ë©”ì¸ ì´ë¯¸ì§€</label>
                    <div class="image-edit-area">
                        <div class="current-image" th:if="${product?.thumbnailUrl}">
                            <p class="label-small">í˜„ì¬ ì´ë¯¸ì§€</p>
                            <img th:src="@{${product?.thumbnailUrl}}" alt="ë©”ì¸ ì´ë¯¸ì§€" />
                        </div>
                        <div class="image-upload">
                            <input type="file" id="main-image" name="mainImage" accept="image/*" style="display: none;" />
                            <label for="main-image" class="image-upload-btn">
                                <span class="upload-icon">ğŸ“·</span>
                                <span>ìƒˆ ì´ë¯¸ì§€ ì„ íƒ</span>
                            </label>
                            <div class="image-preview" id="main-preview"></div>
                        </div>
                    </div>
                </div>

<!--                <div class="form-group">-->
<!--                    <label>ìƒì„¸ ì´ë¯¸ì§€</label>-->
<!--                    <div class="image-edit-area">-->
<!--                        <div class="current-images" th:if="${product?.detailImages}">-->
<!--                            <p class="label-small">í˜„ì¬ ì´ë¯¸ì§€</p>-->
<!--                            <div class="detail-images-grid">-->
<!--                                <img th:each="img : ${product?.detailImages}" th:src="@{${img}}" alt="ìƒì„¸ ì´ë¯¸ì§€" />-->
<!--                            </div>-->
<!--                        </div>-->
<!--                        <div class="image-upload">-->
<!--                            <input type="file" id="detail-images" name="detailImages" multiple accept="image/*" style="display: none;" />-->
<!--                            <label for="detail-images" class="image-upload-btn">-->
<!--                                <span class="upload-icon">ğŸ“¸</span>-->
<!--                                <span>ìƒì„¸ ì´ë¯¸ì§€ ì„ íƒ (ìµœëŒ€ 5ì¥)</span>-->
<!--                            </label>-->
<!--                            <div class="detail-preview" id="detail-preview"></div>-->
<!--                        </div>-->
<!--                    </div>-->
<!--                </div>-->
            </div>

<!--            &lt;!&ndash; ë°°ì†¡ ì„¹ì…˜ &ndash;&gt;-->
<!--            <div class="form-section-box">-->
<!--                <h3 class="section-title">ë°°ì†¡ ì •ë³´</h3>-->

<!--                <div class="form-group">-->
<!--                    <label>ë°°ì†¡ë¹„</label>-->
<!--                    <div class="delivery-options">-->
<!--                        <label class="radio-label">-->
<!--                            <input type="radio" name="deliveryType" value="free" th:checked="${product?.deliveryType == 'free'}" />-->
<!--                            <span>ë¬´ë£Œ</span>-->
<!--                        </label>-->
<!--                        <label class="radio-label">-->
<!--                            <input type="radio" name="deliveryType" value="paid" th:checked="${product?.deliveryType == 'paid'}" />-->
<!--                            <span>ìœ ë£Œ</span>-->
<!--                        </label>-->
<!--                    </div>-->
<!--                </div>-->

<!--                <div class="form-group" id="delivery-fee-group" th:style="${product?.deliveryType == 'paid'} ? '' : 'display: none;'">-->
<!--                    <label>ë°°ì†¡ë¹„ ê¸ˆì•¡</label>-->
<!--                    <input type="number" name="deliveryFee" th:value="${product?.deliveryFee}" placeholder="0" min="0" />-->
<!--                    <span class="unit">ì›</span>-->
<!--                </div>-->

<!--                <div class="form-group">-->
<!--                    <label>ë°°ì†¡ ì„¤ëª…</label>-->
<!--                    <input type="text" name="deliveryDescription" th:value="${product?.deliveryDescription}" placeholder="ì˜ˆ: ë‹¹ì¼ ë°°ì†¡, 2-3ì¼ ë°°ì†¡" />-->
<!--                </div>-->
<!--            </div>-->

            <!-- ìƒí’ˆ ìƒíƒœ -->
            <div class="form-section-box">
                <h3 class="section-title">ìƒí’ˆ ìƒíƒœ</h3>

                <div class="status-info">
                    <div class="info-row">
                        <span class="label">ë“±ë¡ì¼</span>
                        <span class="value" th:text="${#temporals.format(product?.createdAt, 'yyyy.MM.dd HH:mm')}">2024.10.20 14:30</span>
                    </div>
                    <div class="info-row">
                        <span class="label">ìˆ˜ì •ì¼</span>
                        <span class="value" th:text="${#temporals.format(product?.updatedAt, 'yyyy.MM.dd HH:mm')}">2024.10.25 10:15</span>
                    </div>
                    <div class="info-row">
                        <span class="label">íŒë§¤ ìƒíƒœ</span>
                        <span class="value">
<!--                                <input type="checkbox" name="isActive" id="is-active" th:checked="${product?.isActive}" />-->
<!--                                <label for="is-active">íŒë§¤ì¤‘</label>-->
                            <select name="status">
                                <option value="ACTIVE"
                                        th:selected="${product?.status != null and product.status.name() == 'ACTIVE'}">
                                    ACTIVE
                                </option>
                                <option value="INACTIVE"
                                        th:selected="${product?.status != null and product.status.name() == 'INACTIVE'}">
                                    INACTIVE
                                </option>
                            </select>
                        </span>
                    </div>
                </div>
            </div>

            <!-- ë²„íŠ¼ -->
            <div style="display: flex; justify-content: space-between; gap: 12px; margin-top: 40px;">
                <button type="button" class="btn btn-cancel" onclick="history.back()" style="padding: 16px 24px; background: white; border: 1px solid #e5e7eb; color: #666; font-size: 16px; font-weight: 600; border-radius: 8px; cursor: pointer;">ì·¨ì†Œ</button>

                <div style="display: flex; gap: 12px;">
                    <button type="button" class="btn" onclick="deleteProduct()" style="padding: 16px 24px; background: white; border: 1px solid #dc2626; color: #dc2626; font-size: 16px; font-weight: 600; border-radius: 8px; cursor: pointer;">ìƒí’ˆ ì‚­ì œ</button>
                    <button type="submit" class="btn btn-submit" style="padding: 16px 48px; background: #2563EB; border: none; color: white; font-size: 16px; font-weight: 600; border-radius: 8px; cursor: pointer;">ìˆ˜ì • ì™„ë£Œ</button>
                </div>
            </div>
        </form>
    </div>
</section>

<!-- í‘¸í„° ì‚½ì… -->
<div th:replace="~{fragments/footer :: footer}"></div>

<script>
    // ê¸€ììˆ˜ ì¹´ìš´íŒ…
    document.querySelector('input[name="productName"]').addEventListener('input', function() {
        document.getElementById('name-count').textContent = this.value.length;
    });

    document.querySelector('input[name="shortDescription"]').addEventListener('input', function() {
        document.getElementById('short-count').textContent = this.value.length;
    });

    // ë°°ì†¡ ìœ ë£Œ/ë¬´ë£Œ ì„ íƒ
    document.querySelectorAll('input[name="deliveryType"]').forEach(radio => {
        radio.addEventListener('change', function() {
            const feeGroup = document.getElementById('delivery-fee-group');
            feeGroup.style.display = this.value === 'paid' ? 'block' : 'none';
        });
    });

    // ë©”ì¸ ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸°
    document.getElementById('main-image').addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(event) {
                const preview = document.getElementById('main-preview');
                preview.innerHTML = `<img src="${event.target.result}" alt="ë©”ì¸ ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸°" />`;
            };
            reader.readAsDataURL(file);
        }
    });

    // ìƒì„¸ ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸°
    document.getElementById('detail-images').addEventListener('change', function(e) {
        const preview = document.getElementById('detail-preview');
        preview.innerHTML = '';

        Array.from(e.target.files).slice(0, 5).forEach(file => {
            const reader = new FileReader();
            reader.onload = function(event) {
                const img = document.createElement('img');
                img.src = event.target.result;
                img.alt = 'ìƒì„¸ ì´ë¯¸ì§€';
                preview.appendChild(img);
            };
            reader.readAsDataURL(file);
        });
    });

    // ìƒí’ˆ ì‚­ì œ
    function deleteProduct() {
        if (confirm('ì •ë§ ì´ ìƒí’ˆì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì‚­ì œ í›„ ë³µêµ¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) {
            if (confirm('ì‚­ì œë¥¼ ë‹¤ì‹œ í•œ ë²ˆ í™•ì¸í•´ì£¼ì„¸ìš”.')) {
                alert('ìƒí’ˆì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                location.href = '/seller/inventory';
            }
        }
    }

</script>
</body>
</html>
