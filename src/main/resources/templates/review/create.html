<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìŠ¤ë§ˆíŠ¸ìŠ¤í† ì–´ - ë¦¬ë·° ì‘ì„±</title>
    <link th:href="@{/css/store.css}" rel="stylesheet" />
</head>
<body>
<!-- í—¤ë” ì‚½ì… -->
<div th:replace="~{fragments/header :: header}"></div>

<!-- ë¦¬ë·° ì‘ì„± -->
<section class="review-create-section">
    <div class="container">
        <!-- í˜ì´ì§€ íƒ€ì´í‹€ -->
        <div class="page-header">
            <h2 class="page-title">ë¦¬ë·° ì‘ì„±</h2>
            <p class="page-description">êµ¬ë§¤í•˜ì‹  ìƒí’ˆì€ ì–´ë– ì…¨ë‚˜ìš”?</p>
        </div>

        <!-- ë¦¬ë·° ì‘ì„± í¼ -->
        <div class="review-form-wrapper">
            <form id="review-form" method="post" th:action="@{/reviews/create}" enctype="multipart/form-data">
                <input type="hidden" name="productId" th:value="${product?.productId}" />

                <!-- ìƒí’ˆ ì •ë³´ -->
                <div class="review-product-info">
                    <div class="product-image">
                        <img th:src="@{${product?.imageUrl}}" th:alt="${product?.name}" />
                    </div>
                    <div class="product-details">
                        <h3 class="product-name" th:text="${product?.name}">ìƒí’ˆëª…</h3>
                        <p class="product-option" th:if="${product?.optionName}" th:text="'ì˜µì…˜: ' + ${product.optionName}">ì˜µì…˜: ë¸”ë™</p>
                    </div>
                </div>

                <!-- í‰ì  -->
                <div class="form-section">
                    <label class="section-label">
                        í‰ì  <span class="required">*</span>
                    </label>
                    <div class="star-rating-input">
                        <input type="radio" id="star5" name="rating" value="5" />
                        <label for="star5" title="5ì ">â˜…</label>
                        <input type="radio" id="star4" name="rating" value="4" />
                        <label for="star4" title="4ì ">â˜…</label>
                        <input type="radio" id="star3" name="rating" value="3" />
                        <label for="star3" title="3ì ">â˜…</label>
                        <input type="radio" id="star2" name="rating" value="2" />
                        <label for="star2" title="2ì ">â˜…</label>
                        <input type="radio" id="star1" name="rating" value="1" />
                        <label for="star1" title="1ì ">â˜…</label>
                    </div>
                    <p class="rating-text" id="rating-text">ë³„ì ì„ ì„ íƒí•´ì£¼ì„¸ìš”</p>
                </div>

                <!-- ë¦¬ë·° ë‚´ìš© -->
                <div class="form-section">
                    <label class="section-label" for="content">
                        ë¦¬ë·° ë‚´ìš© <span class="required">*</span>
                    </label>
                    <textarea
                            id="content"
                            name="content"
                            rows="10"
                            placeholder="ìƒí’ˆì— ëŒ€í•œ ì†”ì§í•œ ë¦¬ë·°ë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš”.&#10;&#10;â€¢ ìµœì†Œ 10ì ì´ìƒ ì‘ì„±í•´ì£¼ì„¸ìš”&#10;â€¢ ìƒí’ˆê³¼ ê´€ë ¨ì—†ëŠ” ë‚´ìš©ì´ë‚˜ ìš•ì„¤ì€ ì‚­ì œë  ìˆ˜ ìˆìŠµë‹ˆë‹¤"
                            required
                            minlength="10"></textarea>
                    <div class="char-count">
                        <span id="current-count">0</span> / ìµœì†Œ 10ì
                    </div>
                </div>

                <!-- ì‚¬ì§„ ì²¨ë¶€ -->
                <div class="form-section">
                    <label class="section-label">
                        ì‚¬ì§„ ì²¨ë¶€ (ì„ íƒ)
                    </label>
                    <div class="photo-upload-wrapper">
                        <input type="file" id="photo-input" name="photos" multiple accept="image/*" style="display: none;" />
                        <label for="photo-input" class="photo-upload-btn">
                            <span class="upload-icon">ğŸ“·</span>
                            <span class="upload-text">ì‚¬ì§„ ì¶”ê°€<br/>(ìµœëŒ€ 5ì¥)</span>
                        </label>
                        <div class="photo-preview-area" id="photo-preview"></div>
                    </div>
                    <p class="photo-help-text">â€¢ ìƒí’ˆê³¼ ê´€ë ¨ëœ ì‚¬ì§„ì„ ì²¨ë¶€í•˜ë©´ ë”ìš± ìœ ìš©í•œ ë¦¬ë·°ê°€ ë©ë‹ˆë‹¤</p>
                </div>

                <!-- ì¶”ì²œ ì˜µì…˜ -->
                <div class="form-section">
                    <label class="section-label">
                        ì´ ìƒí’ˆì„ ì¶”ì²œí•˜ì‹œë‚˜ìš”?
                    </label>
                    <div class="recommend-options">
                        <label class="recommend-item">
                            <input type="radio" name="recommend" value="true" />
                            <div class="recommend-box">
                                <span class="emoji">ğŸ‘</span>
                                <span class="text">ì¶”ì²œí•´ìš”</span>
                            </div>
                        </label>
                        <label class="recommend-item">
                            <input type="radio" name="recommend" value="false" />
                            <div class="recommend-box">
                                <span class="emoji">ğŸ‘</span>
                                <span class="text">ë¹„ì¶”ì²œí•´ìš”</span>
                            </div>
                        </label>
                    </div>
                </div>

                <!-- ì•½ê´€ ë™ì˜ -->
                <div class="form-section">
                    <div class="agreement-box">
                        <label class="agreement-label">
                            <input type="checkbox" id="agree-terms" required />
                            <span class="agreement-text">
                                    ë¦¬ë·° ì‘ì„± ì‹œ <a href="#" class="link">ê°œì¸ì •ë³´ ìˆ˜ì§‘ ë° ì´ìš©</a>ì— ë™ì˜í•©ë‹ˆë‹¤
                                    <span class="required">(í•„ìˆ˜)</span>
                                </span>
                        </label>
                    </div>
                </div>

                <!-- ë²„íŠ¼ -->
                <div class="form-actions">
                    <button type="button" class="btn btn-cancel" onclick="history.back()">ì·¨ì†Œ</button>
                    <button type="submit" class="btn btn-submit">ë¦¬ë·° ë“±ë¡</button>
                </div>
            </form>
        </div>
    </div>
</section>


<!-- í‘¸í„° ì‚½ì… -->
<div th:replace="~{fragments/footer :: footer}"></div>

<script>
    // ë³„ì  ì„ íƒ
    const ratingInputs = document.querySelectorAll('.star-rating-input input[type="radio"]');
    const ratingText = document.getElementById('rating-text');
    const ratingMessages = {
        '5': 'â­ ìµœê³ ì˜ˆìš”!',
        '4': 'â­ ë§Œì¡±í•´ìš”',
        '3': 'â­ ë³´í†µì´ì—ìš”',
        '2': 'â­ ê·¸ì € ê·¸ë˜ìš”',
        '1': 'â­ ë³„ë¡œì˜ˆìš”'
    };

    ratingInputs.forEach(input => {
        input.addEventListener('change', function() {
            ratingText.textContent = ratingMessages[this.value];
            ratingText.style.color = '#2563EB';
        });
    });

    // ê¸€ì ìˆ˜ ì¹´ìš´íŒ…
    const contentTextarea = document.getElementById('content');
    const currentCount = document.getElementById('current-count');

    contentTextarea.addEventListener('input', function() {
        const length = this.value.length;
        currentCount.textContent = length;

        if (length >= 10) {
            currentCount.style.color = '#059669';
        } else {
            currentCount.style.color = '#dc2626';
        }
    });

    // ì‚¬ì§„ ë¯¸ë¦¬ë³´ê¸°
    const photoInput = document.getElementById('photo-input');
    const photoPreview = document.getElementById('photo-preview');
    let selectedFiles = [];

    photoInput.addEventListener('change', function(e) {
        const files = Array.from(e.target.files);

        if (selectedFiles.length + files.length > 5) {
            alert('ì‚¬ì§„ì€ ìµœëŒ€ 5ì¥ê¹Œì§€ ì²¨ë¶€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
            return;
        }

        files.forEach(file => {
            if (file.type.startsWith('image/')) {
                selectedFiles.push(file);
                displayPhoto(file);
            }
        });
    });

    function displayPhoto(file) {
        const reader = new FileReader();

        reader.onload = function(e) {
            const photoItem = document.createElement('div');
            photoItem.className = 'photo-item';
            photoItem.innerHTML = `
                    <img src="${e.target.result}" alt="ë¯¸ë¦¬ë³´ê¸°" />
                    <button type="button" class="photo-remove-btn" onclick="removePhoto(this, '${file.name}')">Ã—</button>
                `;
            photoPreview.appendChild(photoItem);
        };

        reader.readAsDataURL(file);
    }

    function removePhoto(button, fileName) {
        button.parentElement.remove();
        selectedFiles = selectedFiles.filter(f => f.name !== fileName);
    }

    // í¼ ì œì¶œ ê²€ì¦
    document.getElementById('review-form').addEventListener('submit', function(e) {
        const rating = document.querySelector('input[name="rating"]:checked');
        const content = document.getElementById('content').value;
        const agree = document.getElementById('agree-terms').checked;

        if (!rating) {
            e.preventDefault();
            alert('ë³„ì ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
            return;
        }

        if (content.length < 10) {
            e.preventDefault();
            alert('ë¦¬ë·° ë‚´ìš©ì„ ìµœì†Œ 10ì ì´ìƒ ì‘ì„±í•´ì£¼ì„¸ìš”.');
            return;
        }

        if (!agree) {
            e.preventDefault();
            alert('ê°œì¸ì •ë³´ ìˆ˜ì§‘ ë° ì´ìš©ì— ë™ì˜í•´ì£¼ì„¸ìš”.');
            return;
        }
    });
</script>
</body>
</html>
