<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${product?.name} + ' - 스마트스토어'">상품 상세 - 스마트스토어</title>
    <link th:href="@{/css/store.css}" rel="stylesheet" />
</head>
<body>
<!-- 헤더 삽입 -->
<div th:replace="~{fragments/header :: header}"></div>

<!-- 상품 상세 -->
<section class="product-detail-section">
    <div class="container">
        <!-- 상품 정보 영역 -->
        <div class="product-detail-top">
            <!-- 상품 이미지 -->
            <div class="product-image-area">
                <div class="main-image">
                    <img th:src="@{${product?.imageUrl ?: '/images/placeholder.jpg'}}"
                         th:alt="${product?.name}" />
                </div>
                <!-- 썸네일 이미지 (여러 개일 경우) -->
                <div class="thumbnail-list" th:if="${product?.images != null}">
                    <div class="thumbnail-item" th:each="img : ${product.images}">
                        <img th:src="@{${img}}" th:alt="상품 이미지" />
                    </div>
                </div>
            </div>

            <!-- 상품 정보 -->
            <div class="product-info-area">
                <!-- 상품명 -->
                <h1 class="product-title" th:text="${product?.name ?: '상품명'}">상품명</h1>

                <!-- 상점 정보 -->
                <div class="store-info">
                    <span class="store-name" th:text="${product?.storeName ?: '상점명'}">상점명</span>
                    <button class="btn-store">스토어 홈</button>
                </div>

                <!-- 리뷰 정보 -->
                <div class="review-info">
                        <span class="rating">
                            <span class="star">★★★★★</span>
                            <strong th:text="${product?.rating ?: '0.0'}">4.8</strong>
                        </span>
                    <span class="review-count">
                            (<span th:text="${product?.reviewCount ?: 0}">128</span>개 리뷰)
                        </span>
                </div>

                <!-- 가격 정보 -->
                <div class="price-area">
                    <div class="original-price" th:if="${product?.originalPrice != null}">
                        <span th:text="${#numbers.formatInteger(product.originalPrice, 0, 'COMMA')} + '원'">50,000원</span>
                    </div>
                    <div class="discount-info" th:if="${product?.discountRate != null}">
                        <span class="discount-rate" th:text="${product.discountRate} + '%'">20%</span>
                        <span class="discount-label">할인</span>
                    </div>
                    <div class="final-price">
                        <strong th:text="${#numbers.formatInteger(product?.price ?: 0, 0, 'COMMA')} + '원'">40,000원</strong>
                    </div>
                </div>

                <!-- 배송 정보 -->
                <div class="delivery-info">
                    <div class="info-row">
                        <span class="label">배송비</span>
                        <span class="value">무료배송</span>
                    </div>
                    <div class="info-row">
                        <span class="label">배송 예정</span>
                        <span class="value">오늘 출발 (12시 이전 주문 시)</span>
                    </div>
                </div>

                <!-- 옵션 선택 -->
                <div class="option-area">
                    <label class="option-label">옵션 선택</label>
                    <select class="option-select" id="product-option">
                        <option value="">옵션을 선택하세요</option>
                        <option th:each="option : ${product?.options}"
                                th:value="${option.optionId}"
                                th:text="${option.optionName} + ' (+' + ${#numbers.formatInteger(option.price, 0, 'COMMA')} + '원)'"
                                th:disabled="${option.stockQty <= 0}">
                            색상: 블랙 (+0원)
                        </option>
                    </select>
                </div>

                <!-- 수량 선택 -->
                <div class="quantity-area">
                    <label class="option-label">수량</label>
                    <div class="quantity-control">
                        <button class="qty-btn minus">-</button>
                        <input type="number" class="qty-input" value="1" min="1" />
                        <button class="qty-btn plus">+</button>
                    </div>
                </div>

                <!-- 총 금액 -->
                <div class="total-price-area">
                    <span class="total-label">총 상품금액</span>
                    <span class="total-price">
                            <strong th:text="${#numbers.formatInteger(product?.price ?: 0, 0, 'COMMA')}">40,000</strong>원
                        </span>
                </div>

                <!-- 구매 버튼 -->
                <div class="button-area">
                    <button class="btn btn-cart">장바구니</button>
                    <button class="btn btn-buy">바로구매</button>
                </div>
            </div>
        </div>

        <!-- 상품 상세 탭 -->
        <div class="product-detail-tabs">
            <div class="tab-header">
                <button class="tab-btn active" data-tab="description">상품정보</button>
                <button class="tab-btn" data-tab="reviews">리뷰 (<span th:text="${product?.reviewCount ?: 0}">128</span>)</button>
                <button class="tab-btn" data-tab="qna">문의</button>
                <button class="tab-btn" data-tab="delivery">배송/교환/반품</button>
            </div>

            <!-- 상품정보 탭 -->
            <div class="tab-content active" id="description">
                <div class="description-content">
                    <p th:utext="${product?.description ?: '상품 설명이 없습니다.'}">
                        상품 설명 내용이 들어갑니다.
                    </p>
                </div>
            </div>

            <!-- 리뷰 탭 -->
            <div class="tab-content" id="reviews">
                <div class="review-summary">
                    <div class="rating-summary">
                        <h3>구매자 평점</h3>
                        <div class="rating-score">
                            <span class="score" th:text="${product?.rating ?: '0.0'}">4.8</span>
                            <span class="max">/5</span>
                        </div>
                        <div class="star-display">★★★★★</div>
                    </div>
                </div>

                <!-- 리뷰 리스트 -->
                <div class="review-list">
                    <div class="review-item" th:each="review : ${reviews}">
                        <div class="review-header">
                            <span class="reviewer" th:text="${review.memberName}">홍길동</span>
                            <span class="review-rating">★★★★★</span>
                            <span class="review-date" th:text="${#temporals.format(review.createdAt, 'yyyy.MM.dd')}">2024.10.20</span>
                        </div>
                        <div class="review-content" th:text="${review.content}">
                            상품 정말 좋아요! 배송도 빠르고 품질도 훌륭합니다.
                        </div>
                    </div>

                    <!-- 리뷰 없을 때 -->
                    <div class="empty-review" th:if="${reviews == null or reviews.isEmpty()}">
                        <p>아직 작성된 리뷰가 없습니다.</p>
                    </div>
                </div>
            </div>

            <!-- 문의 탭 -->
            <div class="tab-content" id="qna">
                <div class="qna-section">
                    <p>상품에 대해 궁금한 점을 문의해주세요.</p>
                    <button class="btn btn-primary">문의하기</button>
                </div>
            </div>

            <!-- 배송/교환/반품 탭 -->
            <div class="tab-content" id="delivery">
                <div class="policy-content">
                    <h3>배송 안내</h3>
                    <p>- 배송비: 무료배송</p>
                    <p>- 배송 기간: 주문 후 1-2일 이내 출발</p>

                    <h3>교환/반품 안내</h3>
                    <p>- 교환/반품 가능 기간: 상품 수령 후 7일 이내</p>
                    <p>- 고객 변심으로 인한 교환/반품 시 배송비는 고객 부담</p>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- 푸터 삽입 -->
<div th:replace="~{fragments/footer :: footer}"></div>

<!-- 간단한 탭 전환 스크립트 -->
<script>
    document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            // 모든 탭 비활성화
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));

            // 선택된 탭 활성화
            this.classList.add('active');
            const tabId = this.getAttribute('data-tab');
            document.getElementById(tabId).classList.add('active');
        });
    });

    // 수량 조절
    document.querySelector('.minus')?.addEventListener('click', function() {
        const input = document.querySelector('.qty-input');
        if (input.value > 1) input.value = parseInt(input.value) - 1;
    });

    document.querySelector('.plus')?.addEventListener('click', function() {
        const input = document.querySelector('.qty-input');
        input.value = parseInt(input.value) + 1;
    });
</script>
</body>
</html>
